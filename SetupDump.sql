/* SETUP */

DROP DATABASE IF EXISTS krautundrueben;
CREATE DATABASE IF NOT EXISTS krautundrueben;
USE krautundrueben;

/* primary key table */

CREATE TABLE KUNDE (
    KUNDENNR        INTEGER AUTO_INCREMENT NOT NULL,
    NACHNAME        VARCHAR(100),
    VORNAME         VARCHAR(50),
    GEBURTSDATUM	  DATE,
	 STRASSE         VARCHAR(50),
	 HAUSNR			  VARCHAR(6),			
    PLZ             VARCHAR(5),
    ORT             VARCHAR(50),
    TELEFON         VARCHAR(25),
    EMAIL           VARCHAR(50),
    PRIMARY KEY (KUNDENNR)
    );

CREATE TABLE ZUTAT(
    ZUTATENNR			INTEGER AUTO_INCREMENT NOT NULL,
    BEZEICHNUNG      VARCHAR(50),
    EINHEIT        	VARCHAR (25),
    NETTOPREIS       DECIMAL(10,2),
    BESTAND          INTEGER,
    LIEFERANTENNR			INTEGER,
	 KALORIEN			INTEGER,
	 KOHLENHYDRATE		DECIMAL (10,2),
	 PROTEIN				DECIMAL(10,2),
    PRIMARY KEY (ZUTATENNR)
);

CREATE TABLE BESTELLUNG (
    BESTELLNR        INTEGER AUTO_INCREMENT NOT NULL,
    KUNDENNR         INTEGER,
    BESTELLDATUM     DATE,
    RECHNUNGSBETRAG  DECIMAL(10,2),
    PRIMARY KEY (BESTELLNR)
);

CREATE TABLE LIEFERANT (
    LIEFERANTENNR   INTEGER AUTO_INCREMENT NOT NULL,
    LIEFERANTENNAME VARCHAR(50),
    STRASSE         VARCHAR(50),
    HAUSNR			  VARCHAR(6),
    PLZ             VARCHAR(5),
    ORT             VARCHAR(50),
    TELEFON			  VARCHAR(25),
    EMAIL           VARCHAR(50),
    PRIMARY KEY (LIEFERANTENNR)
);

CREATE TABLE REZEPT (
	REZEPTNR	INTEGER AUTO_INCREMENT NOT NULL,
    REZEPTNAME	VARCHAR(100),
    BESCHREIBUNG VARCHAR(1000),
    ZUBEREITUNGSZEIT INTEGER NOT NULL,
    PRIMARY KEY (REZEPTNR)
);

CREATE TABLE ALLERGEN(
ALLERGENNR		INTEGER AUTO_INCREMENT NOT NULL,
ALLERGENNAME	VARCHAR(50),
    PRIMARY KEY (ALLERGENNR)
);

CREATE TABLE ERNAEHRUNGSKATEGORIE(
ERNAEHRUNGSKATEGORIENR		INTEGER AUTO_INCREMENT NOT NULL,
ERNAEHRUNGSKATEGORIENAME	VARCHAR(50),
PRIMARY KEY (ERNAEHRUNGSKATEGORIENR)
);

/* foreign key table */

CREATE TABLE BESTELLUNGZUTAT (
    BESTELLNR       INTEGER NOT NULL,
    ZUTATENNR       INTEGER,
    MENGE     		  INTEGER
);

CREATE TABLE REZEPTZUTAT (
    REZEPTNR       INTEGER NOT NULL,
    ZUTATENNR       INTEGER,
    MENGE     		  INTEGER,
    EINHEIT			VARCHAR(50)
);

CREATE TABLE ZUTATALLERGEN (
    ALLERGENNR       INTEGER NOT NULL,
    ZUTATENNR       INTEGER
);

CREATE TABLE REZEPTERNAEHRUNGSKATEGORIE (
    REZEPTNR       INTEGER NOT NULL,
    ERNAEHRUNGSKATEGORIENR       INTEGER NOT NULL
);


/******************************************************************************/
/***                              Primary Keys                              ***/
/******************************************************************************/

/* primary */
/*
ALTER TABLE ZUTAT ADD PRIMARY KEY (ZUTATENNR);
ALTER TABLE KUNDE ADD PRIMARY KEY (KUNDENNR);
ALTER TABLE LIEFERANT ADD PRIMARY KEY (LIEFERANTENNR);
ALTER TABLE REZEPT ADD PRIMARY KEY (REZEPTNR);
ALTER TABLE ALLERGEN ADD PRIMARY KEY (ALLERGENNR);
ALTER TABLE ERNAEHRUNGSKATEGORIE ADD PRIMARY KEY (ERNAEHRUNGSKATEGORIENR);
*/
/* foreign */
ALTER TABLE BESTELLUNGZUTAT ADD PRIMARY KEY (BESTELLNR,ZUTATENNR);
ALTER TABLE REZEPTZUTAT ADD PRIMARY KEY (REZEPTNR,ZUTATENNR);
ALTER TABLE ZUTATALLERGEN ADD PRIMARY KEY (ALLERGENNR,ZUTATENNR);
ALTER TABLE REZEPTERNAEHRUNGSKATEGORIE ADD PRIMARY KEY (REZEPTNR,ERNAEHRUNGSKATEGORIENR);

/******************************************************************************/
/***                              Foreign Keys                              ***/
/******************************************************************************/

/* WELCHER LIEFERANT */
ALTER TABLE ZUTAT ADD FOREIGN KEY (LIEFERANTENNR) REFERENCES LIEFERANT (LIEFERANTENNR);    

/* WELCHE BESTELLUNG ZU WELCHEM KUNDEN */
ALTER TABLE BESTELLUNG ADD FOREIGN KEY (KUNDENNR) REFERENCES KUNDE (KUNDENNR);

/* BESTELLUNGZUTAT FOREIGN KEYS */
ALTER TABLE BESTELLUNGZUTAT ADD FOREIGN KEY (BESTELLNR) REFERENCES BESTELLUNG (BESTELLNR);
ALTER TABLE BESTELLUNGZUTAT ADD FOREIGN KEY (ZUTATENNR) REFERENCES ZUTAT (ZUTATENNR);

/* REZEPTZUTAT FOREIGN KEYS */
ALTER TABLE REZEPTZUTAT ADD FOREIGN KEY (REZEPTNR) REFERENCES REZEPT (REZEPTNR);
ALTER TABLE REZEPTZUTAT ADD FOREIGN KEY (ZUTATENNR) REFERENCES ZUTAT (ZUTATENNR);

/* ZUTATALLERGEN */
ALTER TABLE ZUTATALLERGEN ADD FOREIGN KEY (ALLERGENNR) REFERENCES ALLERGEN (ALLERGENNR);
ALTER TABLE ZUTATALLERGEN ADD FOREIGN KEY (ZUTATENNR) REFERENCES ZUTAT (ZUTATENNR);

/* REZEPTERNAEHRUNGSKATEGORIE */
ALTER TABLE REZEPTERNAEHRUNGSKATEGORIE ADD FOREIGN KEY (REZEPTNR) REFERENCES REZEPT (REZEPTNR);
ALTER TABLE REZEPTERNAEHRUNGSKATEGORIE ADD FOREIGN KEY (ERNAEHRUNGSKATEGORIENR) REFERENCES ERNAEHRUNGSKATEGORIE (ERNAEHRUNGSKATEGORIENR);





